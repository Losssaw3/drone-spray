#!/bin/bash

# –°–∫—Ä–∏–ø—Ç: generate_keys.sh
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSA –∫–ª—é—á–µ–π –¥–ª—è –≠–¶–ü –≤ PEM-—Ñ–æ—Ä–º–∞—Ç–µ
# –¢—Ä–µ–±—É–µ—Ç: OpenSSL

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
KEY_SIZE=2048           # –†–∞–∑–º–µ—Ä –∫–ª—é—á–∞ (2048/3072/4096)
PRIVATE_KEY="private_key.pem"  # –§–∞–π–ª –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
PUBLIC_KEY="public_key.pem"    # –§–∞–π–ª –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
echo "üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ RSA-$KEY_SIZE..."
openssl genpkey \
    -algorithm RSA \
    -pkeyopt rsa_keygen_bits:$KEY_SIZE \
    -out $PRIVATE_KEY

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞!"
    exit 1
fi

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
echo "üîë –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞..."
openssl rsa \
    -in $PRIVATE_KEY \
    -pubout \
    -out $PUBLIC_KEY

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞!"
    exit 1
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 600 $PRIVATE_KEY
chmod 644 $PUBLIC_KEY
echo "‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã:"
echo "   ‚Ä¢ –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: $PRIVATE_KEY"
echo "   ‚Ä¢ –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á: $PUBLIC_KEY"